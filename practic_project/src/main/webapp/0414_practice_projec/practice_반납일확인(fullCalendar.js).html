<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ë°˜ë‚© ì˜ˆì •ì¼ ìº˜ë¦°ë”</title>

  <!-- FullCalendar v5 CDN (v6ì€ ëª¨ë“ˆ ì „ìš© í™˜ê²½ì´ë¼ HTMLì— ì§ì ‘ ì“°ê¸° ë¶ˆí¸í•¨) -->
  <link href="../css/main.min.css" rel="stylesheet" />
  <script src="../js/main.min.js"></script>
  <!-- jQuery CDN ë˜ëŠ” ë¡œì»¬ íŒŒì¼ (ì•„ë˜ëŠ” ì˜ˆì‹œ) -->
  <script src="../js/jquery-3.7.1.js"></script>
  
  <script>
  let calendar;
    $(function(){
        console.log("ë¬¸ì„œ ì¤€ë¹„ & ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ë¨!"); 
      const calendarEl = document.getElementById('calendar');
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ko',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,listWeek'
        },
        //ì´ˆê¸° í…ŒìŠ¤íŠ¸ ìš© ì´ë²¤íŠ¸
        events: [
//           {
//             title: 'í™ê¸¸ë™ - ìë°”ì˜ ì •ì„',
//             start: '2025-04-20'
//           },
//           {
//             title: 'ê¹€ì² ìˆ˜ - SQL ì²«ê±¸ìŒ',
//             start: '2025-04-22'
//           }
        ]
      });
      calendar.render();
  		
    
	    $("#fetch_member").on("click", function(){
	    	fetch("/practic_project/Return.do")
	    	.then( resp =>{
	    		console.log(resp);
	    		
	    		if(resp.ok){
	    			return resp.json()
	    		}
	    		else{
	    			throw new Error(resp.statusText)
	    		}
	    	})
	    	.then( data =>{
	    		console.log(data);

	            // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±° (í•„ìš”ì‹œ)
	            calendar.getEvents().forEach(event => event.remove());
	    		
	            calendar.removeAllEvents(); 
	            
	    		data.forEach(item=>{

	    			
	    			
	    			 calendar.addEvent({
	    			      title: `${item.name} - ${item.bookTitle} ëŒ€ì¶œ`,
	    			      start: item.loanDate, // to_char() ì²˜ë¦¬í•œ ê°’, ì˜ˆ: '2025-04-01'
	    			      allDay: true,
	    			      color: 'lightgreen'
	    			    });

	    			    // ë°˜ë‚© ì˜ˆì •ì¼ ì´ë²¤íŠ¸ (ë¶„í™ìƒ‰)
	    			 calendar.addEvent({
	    			      title: `${item.name} - ${item.bookTitle} ë°˜ë‚© ì˜ˆì •`,
	    			      start: item.dueDate, // to_char() ì²˜ë¦¬í•œ ê°’, ì˜ˆ: '2025-04-08'
	    			      allDay: true,
	    			      color: 'lightcoral'
	    			    });
	    			
	    		});
	    		
	    		// â†’ ì—¬ê¸°ì„œ í•œ ë²ˆ ë” ë¡œê·¸
	    		console.log('í˜„ì¬ ìº˜ë¦°ë”ì— ë‚¨ì€ ì´ë²¤íŠ¸ ìˆ˜:', calendar.getEvents().length);
	    		
	    	})
	    	
	    	.catch( err =>{
	    		console.log(err);
	    	})
	    })
    
    });
    
    
  </script>

  <style>
    #calendar {
      max-width: 900px;
      margin: 40px auto;
      height: 600px;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">ğŸ“š ë°˜ë‚© ì˜ˆì •ì¼ í™•ì¸ ìº˜ë¦°ë”(ADM04)</h2>
  <div id="calendar"></div>
  
  <div style="text-align:center; margin-top:20px;">
    <span style="display:inline-block; width:20px; height:20px; background-color:lightgreen; margin-right:5px;"></span> ëŒ€ì¶œì¼
    &nbsp;&nbsp;&nbsp;
    <span style="display:inline-block; width:20px; height:20px; background-color:lightcoral; margin-right:5px;"></span> ë°˜ë‚©ì˜ˆì •ì¼
  </div>
  
  <input type="button" value="ë°˜ë‚© ì˜ˆì •ì¼" id="fetch_member">
</body>
</html>
