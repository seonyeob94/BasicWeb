<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chart.js 연습</title>
<!--   <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script> -->
<script src="../js/chart.umd.min.js"></script>
<script src="../js/jquery-3.7.1.js"></script>
<script>
let myChart;
let myChart1;
$(function(){
	
    const ctx = document.getElementById('myChart').getContext('2d');
    myChart = new Chart(ctx, {
      type: 'pie', // bar, line, pie 등
      data: {
        labels: ["정상반납", "연체", "미반납"],
        datasets: [{
          label: '반납 건수 비율',
          data: [],
          borderWidth: 1,
          backgroundColor: [
        	  'rgba(54, 162, 235, 0.6)',
        	  'rgba(75, 192, 192, 0.6)',
        	  'rgba(255, 99, 132, 0.6)'
        	  
          ]
        }]
      },
      options: {
    	responsive: false,  
        scales: {
            x: { stacked: true },
            y: { stacked: true, beginAtZero: true }
        }
      }
    });
    
   

	$("#fetch_member").on('click', function(){
		fetch("/practic_project/OverallChart.do")
		.then( resp =>{
			
			console.log(resp);
			if(resp.ok){
				
				return resp.json()
			}
			else{
				throw new Error(resp.statusText)
			}
		})
		.then(data => {
		  const stats = data[0]; // getOverallStats는 row 1개만 반환
		  const labels = ["정상반납", "연체", "미반납"];
		  const values = [
		    stats.onTimeReturns,
		    stats.overdueReturns,
		    stats.notReturned
		  ];
		
		  myChart.data.labels = labels;
		  myChart.data.datasets[0].data = values;
		  myChart.update();
		})
		.catch( err =>{
			console.log(err);
		})
	})
})

</script>
<style>
#myChart{
	width : 400px;
	height : 200px;
}
</style>
</head>
<body>
  <canvas id="myChart"></canvas>
  <input type="button" value="비동기fetch" id="fetch_member">
  
</body>
</html>
