<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chart.js ì—°ìŠµ</title>
<!--   <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script> -->
<script src="../js/chart.umd.min.js"></script>
<script src="../js/jquery-3.7.1.js"></script>
<script>
let myChart;
let myChart1;
$(function(){
	
    const ctx = document.getElementById('myChart').getContext('2d');
    myChart = new Chart(ctx, {
      type: 'bar', // bar, line, pie ë“±
      data: {
        labels: [],
        datasets: [{
          label: 'ì›”ë³„ ëŒ€ì¶œ ê±´ìˆ˜',
          data: [],
          borderWidth: 1,
          backgroundColor: 'rgba(54, 162, 235, 0.6)'
        },
        {
            label: 'ë°˜ë‚© ê±´ìˆ˜',
            data: [],
            backgroundColor: 'rgba(75, 192, 192, 0.6)'
          },
          {
            label: 'ì—°ì²´ ê±´ìˆ˜',
            data: [],
            backgroundColor: 'rgba(255, 99, 132, 0.6)'
          }]
      },
      options: {
    	responsive: false,  
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
    
    const ctx1 = document.getElementById('myChart1').getContext('2d');
    myChart1 = new Chart(ctx1, {
      type: 'pie', // bar, line, pie ë“±
      data: {
        labels: ["ì •ìƒë°˜ë‚©", "ì—°ì²´", "ë¯¸ë°˜ë‚©"],
        datasets: [{
          label: 'ë°˜ë‚© ê±´ìˆ˜ ë¹„ìœ¨',
          data: [],
          borderWidth: 1,
          backgroundColor: [
        	  'rgba(54, 162, 235, 0.6)',
        	  'rgba(75, 192, 192, 0.6)',
        	  'rgba(255, 99, 132, 0.6)'
        	  
          ]
        }]
      },
      options: {
    	responsive: false,  
        scales: {
            x: { stacked: true },
            y: { stacked: true, beginAtZero: true }
        }
      }
    });
    

	$("#fetch_member").on('click', function(){
		fetch("/practic_project/Chart.do")
		.then( resp =>{
			
			console.log(resp);
			if(resp.ok){
				
				return resp.json()
			}
			else{
				throw new Error(resp.statusText)
			}
		})
		.then ( data =>{
			console.log(data);
            // dataê°€ ë°°ì—´ì´ë¼ê³  ê°€ì •í•  ë•Œ
            // ë ˆì´ë¸”ê³¼ ë°ì´í„°ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
			const labels = data.map(item =>item.MONTHNO);
			const counts = data.map(item =>item.TOTALLOANS);
			const returns = data.map(item => item.TOTALRETURNS);
			const overdues = data.map(item => item.OVERDUERETURNS);
			
			//chart ì¸ìŠ¤í„´ìŠ¤ ì—…ë°ì´íŠ¸ : ë ˆì´ë¸”ê³¼ ë°ì´í„° ì„¤ì •í›„ update() í˜¸ì¶œ
			myChart.data.labels= labels;
			myChart.data.datasets[0].data = counts;
			myChart.data.datasets[1].data = returns;
			myChart.data.datasets[2].data = overdues;
			myChart.update();
			
		})
		.catch( err =>{
			console.log(err);
		})
		
		
		
		fetch("/practic_project/OverallChart.do")
		.then( resp =>{
			
			console.log(resp);
			if(resp.ok){
				
				return resp.json()
			}
			else{
				throw new Error(resp.statusText)
			}
		})
		.then(data => {
		  const stats = data[0]; // getOverallStatsëŠ” row 1ê°œë§Œ ë°˜í™˜
		  const labels = ["ì •ìƒë°˜ë‚©", "ì—°ì²´", "ë¯¸ë°˜ë‚©"];
		  const values = [
		    stats.ONTIMERETURNS,
		    stats.OVERDUERETURNS,
		    stats.NOTRETURNED
		  ];
		
		  //myChart.data.labels = labels;
		  myChart1.data.datasets[0].data = values;
		  myChart1.update();
		})
		.catch( err =>{
			console.log(err);
		})
	
	
	})
	
	
	
})

</script>
<style>
#myChart{
	width : 400px;
	height : 200px;
}
</style>
</head>
<body>
  <h3>ðŸ“š ëŒ€ì¶œ,ë°˜ë‚©,ì—°ì²´ ì°¨íŠ¸(ADM05)</h2>
  <canvas id="myChart"></canvas><br><br>
  <canvas id="myChart1"></canvas>
  <input type="button" value="ë¹„ë™ê¸°fetch" id="fetch_member">
  
</body>
</html>
