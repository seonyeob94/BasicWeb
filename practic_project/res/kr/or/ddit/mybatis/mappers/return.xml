<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="return">

		

	<resultMap id="returnMap" type="BookLoansVo">
	    <result property="loanNo" column="loan_no"/>
	    <result property="loanDate" column="loan_date"/>
	    <result property="dueDate" column="due_date"/>
	    <result property="returnDate" column="return_date"/>
	    <result property="userNo" column="USER_NO"/>
	    <result property="realBook" column="real_book"/>
	    <result property="policyNo" column="POLICY_NO"/>
	</resultMap>


	<select id="returnListMap" resultType="map">
	 SELECT 
        a.loan_no AS "loanNo",
	    u.name AS "name",
	    b.book_title AS "bookTitle",
	    TO_CHAR(a.loan_date, 'YYYY-MM-DD') AS "loanDate",
	    TO_CHAR(a.due_date, 'YYYY-MM-DD') AS "dueDate",
	    -- NULL일 경우 공백 문자열로 처리
	    CASE 
	      WHEN a.return_date IS NOT NULL 
	      THEN TO_CHAR(a.return_date, 'YYYY-MM-DD')
	      ELSE ''
	    END AS "returnDate"
	  FROM book_loans a
	    JOIN USERS u ON a.user_no = u.user_no
	    JOIN REAL_BOOK bl ON a.real_book = bl.real_book
	    JOIN BOOKS b ON bl.book_no = b.book_no
	</select>
	
	
	
	
</mapper>
